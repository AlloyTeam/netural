/*!
 *  netural v0.1.0 By dntzhang 
 *  Github: https://github.com/AlloyTeam/netural
 *  MIT Licensed.
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Netural=r():e.Netural=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}var t={};return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=1)}([function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]={SIGMOID:0,SOFTMAX:1,RELU:2}},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var a=t(2),u=n(a),i=t(0),o=n(i);o["default"].Network=u["default"],e.exports=o["default"]},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),i=t(3),o=n(i),s=t(0),l=n(s),f=function(){function e(r){a(this,e),this.framework=r.framework,this.layersData=r.layers,this.length=this.framework.length,this.input=r.input,this.learningRate=r.learningRate||.3,this.logs=[],this.output=[],this._init()}return u(e,[{key:"_init",value:function(){var e=this;this.layers=[],this.framework.forEach(function(r,t){e.layers[t]=new o["default"](t);var n=e.layers[t];0!==t&&(e.layersData?n.create(r,e.framework[t-1],e.layersData[t-1]):n.create(r,e.framework[t-1]))})}},{key:"refresh",value:function(){this._init()}},{key:"compute",value:function(e,r){var t=this;e&&(this.input=e),this.layers[0].create(this.framework[0],0),this.input.forEach(function(e,r){t.layers[0].neurons[r].value=e});for(var n=this.layers[0],a=1;a<this.length;a++){for(var u=0,i=this.layers[a].neurons.length;u<i;u++){for(var o=0,s=0,f=n.neurons.length;s<f;s++)o+=n.neurons[s].value*this.layers[a].neurons[u].weights[s];this.layers[a].type===l["default"].SIGMOID?this.layers[a].neurons[u].value=this.sigmoid(o+this.layers[a].neurons[u].b):this.layers[a].type===l["default"].SOFTMAX?this.layers[a].neurons[u].value=o+this.layers[a].neurons[u].b:this.layers[a].type===l["default"].RELU&&(this.layers[a].neurons[u].value=this.relu(o+this.layers[a].neurons[u].b))}this.layers[a].type===l["default"].SOFTMAX&&this.softmax(this.layers[a].neurons),n=this.layers[a]}var c=[];return this.layers[this.layers.length-1].neurons.forEach(function(e){c.push(e.value)}),this.output=c,c}},{key:"train",value:function(e,r,t){"number"==typeof e&&(e=[e]),t||(t={});for(var n=0;n<r;n++){this.compute(t.input,t.onTrain);for(var a=this.length-1;a>0;a--)a===this.length-1?this.derivationOutputSquareError(e,this.layers[a]):this.derivationSquareError(this.layers[a],a)}return t.onEnd&&t.onEnd.call(this),this.out}},{key:"derivationSquareError",value:function(e,r){var t=this;e.type===l["default"].SIGMOID?e.neurons.forEach(function(e,n){var a=0;t.layers[r+1].neurons.forEach(function(e,r){a+=e.squareErrorList[n]});var u=a*e.value*(1-e.value);e.squareErrorList=[],e.b-=t.learningRate*u,e.weights.forEach(function(n,a){e.squareErrorList.push(u*n),e.weights[a]=n-t.learningRate*u*t.getPreOut(r,a)})}):e.type===l["default"].RELU&&e.neurons.forEach(function(e,n){var a=0;t.layers[r+1].neurons.forEach(function(e,r){a+=e.squareErrorList[n]});var u=a*(e.value>0?1:0);e.squareErrorList=[],e.b-=t.learningRate*u,e.weights.forEach(function(n,a){e.squareErrorList.push(u*n),e.weights[a]=n-t.learningRate*u*t.getPreOut(r,a)})})}},{key:"derivationOutputSquareError",value:function(e,r){r.type===l["default"].SOFTMAX?this.derivationSoftMaxSquareError(e,r):r.type===l["default"].SIGMOID?this.derivationSigmoidSquareError(e,r):r.type===l["default"].RELU&&this.derivationReluSquareError(e,r)}},{key:"derivationReluSquareError",value:function(e,r){var t=this;e.forEach(function(n,a){var u=r.neurons[a],i=(u.value-e[a])*(u.value>0?1:0);u.bError=i,u.squareErrorList=[],u.b-=t.learningRate*i,u.weights.forEach(function(e,n){u.squareErrorList.push(i*e),u.weights[n]=e-t.learningRate*i*t.getPreOut(r.index,n)})})}},{key:"derivationSigmoidSquareError",value:function(e,r){var t=this;e.forEach(function(n,a){var u=r.neurons[a],i=(u.value-e[a])*u.value*(1-u.value);u.bError=i,u.squareErrorList=[],u.b-=t.learningRate*i,u.weights.forEach(function(e,n){u.squareErrorList.push(i*e),u.weights[n]=e-t.learningRate*i*t.getPreOut(r.index,n)})})}},{key:"derivationSoftMaxSquareError",value:function(e,r){var t=this,n=this.derivationSoftMax(e,r.neurons);e.forEach(function(e,a){var u=r.neurons[a],i=n[a];u.bError=i,u.squareErrorList=[],u.b-=t.learningRate*u.bError,u.weights.forEach(function(e,n){u.squareErrorList.push(i*e),u.weights[n]=e-t.learningRate*i*t.getPreOut(r.index,n)})})}},{key:"derivationSoftMax",value:function(e,r){var t=e.indexOf(1),n=[];return r.forEach(function(e,r){r===t?n.push(e.value-1):n.push(e.value)}),n}},{key:"getPreOut",value:function(e,r){return this.layers[e-1].neurons[r].value}},{key:"_log",value:function(e){var r=[];this.layers.forEach(function(e,t){0!==t&&e.neurons.forEach(function(e){r.push(e.weights.slice(0))})}),e&&e.call(this,r),this.logs.push(r)}},{key:"sigmoid",value:function(e){return 1/(1+Math.exp(-e))}},{key:"softmaxArr",value:function(e){var r=e.reduce(function(e,r){return e>r?e:r}),t=e.map(function(e){return Math.exp(e-r)}),n=t.reduce(function(e,r){return e+r});return t.map(function(e){return e/n})}},{key:"relu",value:function(e){return Math.max(0,e)}},{key:"softmax",value:function(e){var r=[];e.forEach(function(e){r.push(e.value)}),this.softmaxArr(r).forEach(function(r,t){e[t].value=r})}}]),e}();r["default"]=f},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),u=t(4),i=function(e){return e&&e.__esModule?e:{"default":e}}(u),o=function(){function e(r){n(this,e),this.index=r,this.neurons=[]}return a(e,[{key:"create",value:function(e,r,t){this.neurons=[],t&&(this.type=t.type);for(var n=0;n<e;n++){var a=new i["default"];t?(t.w?a.weights=t.w.slice(0).splice(n*r,r):a.create(r),null!=t.b&&(a.b="number"==typeof t.b?t.b:t.b[n])):a.create(r),this.neurons.push(a)}}}]),e}();r["default"]=o},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),u=function(){function e(r,t){n(this,e),this.value=0,this.weights=r||[],this.b=t||0}return a(e,[{key:"create",value:function(e){this.weights=[];for(var r=0;r<e;r++)this.weights.push(.2*Math.random()-.1)}}]),e}();r["default"]=u}])});